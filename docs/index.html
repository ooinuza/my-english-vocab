<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My English Vocab</title>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; margin: 24px; max-width: 980px; }
    header { display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    input { padding:10px 12px; font-size:16px; width:min(520px, 100%); }
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:12px; margin-top: 16px;}
    .card { border:1px solid #ddd; border-radius:12px; padding:12px; }
    .word { font-size: 22px; font-weight: 700; margin:0; }
    .meta { opacity:.75; font-size: 13px; margin-top: 6px; }
    .meaning { margin-top: 10px; }
    .chips { display:flex; gap:6px; flex-wrap:wrap; margin-top: 10px; }
    .chip { border:1px solid #ddd; border-radius:999px; padding:3px 8px; font-size: 12px; opacity:.85; }
    .ex { margin-top:10px; padding-left: 18px; }
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0;">ðŸ“š My English Vocab</h1>
    <input id="q" placeholder="æ¤œç´¢ï¼ˆword / meaning / tags / notesï¼‰" />
  </header>

  <div class="meta" id="count"></div>
  <div class="grid" id="grid"></div>

<script>
async function load() {
const res = await fetch("./data/words.json", { cache: "no-store" });
}

function card(item) {
  const ex = (item.examples || []).slice(0,2).map(s => `<li>${escapeHtml(s)}</li>`).join("");
  const tags = (item.tags || []).map(t => `<span class="chip">${escapeHtml(t)}</span>`).join("");
  const syn  = (item.synonyms || []).map(s => `<span class="chip">${escapeHtml(s)}</span>`).join("");
  return `
  <div class="card">
    <p class="word">${escapeHtml(item.word)}</p>
    <div class="meta">${escapeHtml(item.part_of_speech || "")} ${escapeHtml(item.pronunciation || "")}</div>
    <div class="meaning">${escapeHtml(item.meaning_ja || "")}</div>
    ${(ex ? `<ul class="ex">${ex}</ul>` : "")}
    <div class="chips">${tags}${syn}</div>
  </div>`;
}

function escapeHtml(s) {
  return (s || "").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

let data = [];
let filtered = [];

function render(list) {
  document.getElementById("count").textContent = `${list.length} words`;
  document.getElementById("grid").innerHTML = list.map(card).join("");
}

function norm(s){ return (s||"").toLowerCase(); }

function apply(q) {
  const nq = norm(q);
  if (!nq) return render(data);
  filtered = data.filter(it => {
    const hay = [
      it.word, it.meaning_ja, it.part_of_speech, it.pronunciation, it.notes,
      ...(it.tags||[]), ...(it.synonyms||[]), ...(it.examples||[])
    ].map(norm).join(" ");
    return hay.includes(nq);
  });
  render(filtered);
}

(async () => {
  data = await load();
  render(data);
  document.getElementById("q").addEventListener("input", e => apply(e.target.value));
})();
</script>
</body>
</html>
